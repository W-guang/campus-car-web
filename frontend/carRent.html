<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§Ÿè½¦ - æ ¡å›­è½¦è¾†ç®¡ç†ç³»ç»Ÿ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://webapi.amap.com/maps?v=2.0&key=a49a852abb90dd6856b2d10227220702&plugin=AMap.Geocoder"></script>
    <style>
        .navbar-brand {
            font-size: 1.8rem !important;
            font-weight: bold;
            pointer-events: none;
            cursor: default;
        }
        .nav-link {
            font-size: 1.1rem;
            margin: 0 8px;
        }
        .mode-tabs {
            border-bottom: 1px solid #e9ecef;
            margin-bottom: 20px;
        }
        .mode-tab {
            padding: 10px 20px;
            border: none;
            background: transparent;
            font-size: 1.1rem;
            color: #666;
            position: relative;
        }
        .mode-tab.active {
            color: #4299e1;
            font-weight: 500;
        }
        .mode-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: #4299e1;
        }
        #rentMap {
            width: 100%;
            height: 60vh;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            display: block;
        }
        .car-list {
            display: none;
        }
        .car-card {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .car-img {
            width: 100px;
            height: 80px;
            object-fit: cover;
            border-radius: 4px;
        }
        .car-info {
            flex: 1;
        }
        .car-type {
            font-size: 0.9rem;
            color: #4299e1;
            background-color: #e8f4f8;
            padding: 2px 8px;
            border-radius: 12px;
            display: inline-block;
            margin-bottom: 5px;
        }
        .car-price {
            font-weight: bold;
            color: #333;
        }
        .car-location {
            font-size: 0.9rem;
            color: #666;
            margin: 5px 0;
        }
        .car-owner {
            font-size: 0.85rem;
            color: #999;
        }
        .modal-header {
            background-color: #e8f4f8;
        }
        .fee-calculator {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        .btn-primary {
            background-color: #4299e1;
            border-color: #4299e1;
        }
        .btn-primary:hover {
            background-color: #3182ce;
            border-color: #3182ce;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-white mb-4 shadow-sm">
        <div class="container">
            <a class="navbar-brand text-primary" href="/index.html">æ ¡å›­è½¦è¾†ç®¡ç†ç³»ç»Ÿ</a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item"><a class="nav-link text-dark" href="/index.html">é¦–é¡µ</a></li>
                    <li class="nav-item"><a class="nav-link active text-primary" href="/carRent.html">ç§Ÿè½¦</a></li>
                    <li class="nav-item"><a class="nav-link text-dark" href="/forum.html">è®ºå›</a></li>
                    <li class="nav-item"><a class="nav-link text-dark" href="/blacklist.html">é»‘åå•</a></li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle text-primary" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                            ä¸ªäººä¸­å¿ƒ
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" id="userMenu">
                            <li><a class="dropdown-item" href="/login.html">è¯·å…ˆç™»å½•</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- ç­›é€‰åŠŸèƒ½ -->
        <div class="filter-section mb-3" style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <div class="row align-items-center">
                <div class="col-md-3">
                    <label class="form-label">è½¦è¾†ç±»å‹ï¼š</label>
                    <div>
                        <label class="me-3"><input type="checkbox" id="filter-ebike" checked> ç”µåŠ¨è½¦</label>
                        <label><input type="checkbox" id="filter-bicycle" checked> è‡ªè¡Œè½¦</label>
                    </div>
                </div>
                <div class="col-md-4">
                    <label class="form-label">ä»·æ ¼èŒƒå›´ï¼š</label>
                    <div class="input-group">
                        <input type="number" id="min-price" class="form-control" value="0" min="0" step="0.5" placeholder="æœ€ä½">
                        <span class="input-group-text">-</span>
                        <input type="number" id="max-price" class="form-control" value="10" min="0" step="0.5" placeholder="æœ€é«˜">
                    </div>
                </div>
                <div class="col-md-2">
                    <button onclick="applyFilter()" class="btn btn-primary w-100">ç­›é€‰</button>
                </div>
                <div class="col-md-3">
                    <button onclick="resetFilter()" class="btn btn-secondary w-100">é‡ç½®</button>
                </div>
            </div>
        </div>

        <div class="mode-tabs">
            <button class="mode-tab active" id="mapModeBtn">åœ°å›¾æ¨¡å¼</button>
            <button class="mode-tab" id="listModeBtn">åˆ—è¡¨æ¨¡å¼</button>
        </div>

        <div id="rentMap"></div>

        <div class="car-list" id="carListContainer">
        </div>
    </div>

    <!-- ç§Ÿè½¦Modal -->
    <div class="modal fade" id="rentModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="rentModalTitle">ç§Ÿç”¨è½¦è¾†</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="rentCarId">
                    <div class="mb-3">
                        <label class="form-label">è½¦è¾†ä¿¡æ¯</label>
                        <div class="card">
                            <div class="card-body">
                                <h6 class="card-title" id="modalCarType">ç”µåŠ¨è½¦</h6>
                                <p class="card-text"><strong>ä½ç½®ï¼š</strong><span id="modalCarLocation">ä¸œåŒºå®¿èˆæ¥¼ä¸‹</span></p>
                                <p class="card-text"><strong>æ—¶ä»·ï¼š</strong><span id="modalCarPrice">3</span>å…ƒ/å°æ—¶</p>
                                <p class="card-text"><strong>è½¦ä¸»ï¼š</strong><span id="modalCarOwner">å¼ **ï¼ˆå­¦ï¼‰</span></p>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="rentHours" class="form-label">ç§Ÿç”¨æ—¶é•¿ï¼ˆå°æ—¶ï¼‰</label>
                        <input type="number" class="form-control" id="rentHours" min="1" max="6" value="2" required>
                        <div class="form-text">å»ºè®®ç§Ÿç”¨1-6å°æ—¶ï¼Œè¶…è¿‡éœ€é‡æ–°ä¸‹å•</div>
                    </div>
                    <div class="fee-calculator">
                        <h6 class="mb-2">è´¹ç”¨è®¡ç®—</h6>
                        <p>æ—¶ä»·ï¼š<span id="calcPrice">3</span>å…ƒ/å°æ—¶</p>
                        <p>æ—¶é•¿ï¼š<span id="calcHours">2</span>å°æ—¶</p>
                        <p class="fw-bold">é¢„è®¡æ€»è´¹ç”¨ï¼š<span id="calcTotal">6</span>å…ƒï¼ˆçº¿ä¸‹æ”¯ä»˜ï¼‰</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                    <button type="button" class="btn btn-primary" id="submitRentBtn">æäº¤è®¢å•</button>
                </div>
            </div>
        </div>
    </div>

    <!-- è®¢å•æˆåŠŸModal - æ˜¾ç¤ºè”ç³»ä¿¡æ¯ -->
    <div class="modal fade" id="orderSuccessModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">ğŸ‰ é¢„è®¢æˆåŠŸ</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-success">
                        <strong>è®¢å•å·²æäº¤ï¼</strong> è½¦ä¸»å·²æ”¶åˆ°é€šçŸ¥ï¼Œç­‰å¾…è½¦ä¸»ç¡®è®¤è®¢å•ã€‚
                    </div>
                    
                    <h6 class="mb-3">ğŸ“‹ è®¢å•ä¿¡æ¯</h6>
                    <div class="card mb-3">
                        <div class="card-body">
                            <p><strong>è®¢å•å·ï¼š</strong><span id="successOrderId">-</span></p>
                            <p><strong>è½¦è¾†ç±»å‹ï¼š</strong><span id="successCarType">-</span></p>
                            <p><strong>å–è½¦åœ°ç‚¹ï¼š</strong><span id="successLocation">-</span></p>
                            <p><strong>ç§Ÿç”¨æ—¶é•¿ï¼š</strong><span id="successHours">-</span> å°æ—¶</p>
                            <p class="mb-0"><strong>é¢„è®¡è´¹ç”¨ï¼š</strong><span id="successFee" class="text-danger fs-5">-</span> å…ƒ</p>
                        </div>
                    </div>

                    <h6 class="mb-3">ğŸ“ è½¦ä¸»è”ç³»æ–¹å¼</h6>
                    <div class="card bg-light">
                        <div class="card-body">
                            <p><strong>è½¦ä¸»å§“åï¼š</strong><span id="successOwnerName">-</span></p>
                            <p class="mb-0"><strong>æ‰‹æœºå·ï¼š</strong><span id="successOwnerPhone" class="text-primary fs-5">-</span></p>
                            <small class="text-muted">è¯·é€šè¿‡ç”µè¯æˆ–å¾®ä¿¡è”ç³»è½¦ä¸»ï¼Œçº¦å®šçº¿ä¸‹äº¤è½¦æ—¶é—´å’Œåœ°ç‚¹</small>
                        </div>
                    </div>

                    <div class="alert alert-info mt-3 mb-0">
                        <strong>ğŸ’¡ æ¸©é¦¨æç¤ºï¼š</strong>
                        <ul class="mb-0 mt-2">
                            <li>è½¦ä¸»ç¡®è®¤åï¼Œè®¢å•çŠ¶æ€å˜ä¸º"å·²ç¡®è®¤"</li>
                            <li>å–è½¦åè¯·çº¿ä¸‹æ”¯ä»˜è´¹ç”¨ç»™è½¦ä¸»</li>
                            <li>ä½¿ç”¨å®Œæ¯•åï¼ŒåŒæ–¹ç¡®è®¤å®Œæˆè®¢å•</li>
                            <li>å¯åœ¨"ä¸ªäººä¸­å¿ƒ-æˆ‘çš„è®¢å•"ä¸­æŸ¥çœ‹è®¢å•çŠ¶æ€</li>
                        </ul>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å…³é—­</button>
                    <button type="button" class="btn btn-primary" onclick="window.location.href='/personalInfo.html?tab=orders'">æŸ¥çœ‹æˆ‘çš„è®¢å•</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let map, markers = [];
        let allVehicles = []; // ä¿å­˜æ‰€æœ‰è½¦è¾†æ•°æ®ç”¨äºç­›é€‰
        
        document.addEventListener("DOMContentLoaded", () => {
            const token = localStorage.getItem("token");
            const userInfo = JSON.parse(localStorage.getItem("userInfo"));
            if (!token || !userInfo) {
                alert("è¯·å…ˆç™»å½•åå†ç§Ÿè½¦");
                window.location.href = "/login.html";
                return;
            }

            initUserMenu();
            // å…ˆåŠ è½½æ‰€æœ‰è½¦è¾†æ•°æ®
            fetch('/api/vehicles')
                .then(r => r.json())
                .then(vehicles => {
                    allVehicles = vehicles;
                    initRentMap();
                    loadCarList();
                });
            bindModeSwitch();
            bindRentEvents();
        });

        // ç­›é€‰åŠŸèƒ½
        function applyFilter() {
            const ebike = document.getElementById('filter-ebike').checked;
            const bicycle = document.getElementById('filter-bicycle').checked;
            const min = parseFloat(document.getElementById('min-price').value) || 0;
            const max = parseFloat(document.getElementById('max-price').value) || Infinity;

            const filtered = allVehicles.filter(v => {
                const typeMatch = (ebike && v.type === 'ebike') || (bicycle && v.type === 'bicycle');
                const priceMatch = v.price_per_hour >= min && v.price_per_hour <= max;
                return typeMatch && priceMatch;
            });

            loadVehiclesOnMap(filtered);
            loadCarList(filtered);
        }

        // é‡ç½®ç­›é€‰
        function resetFilter() {
            document.getElementById('filter-ebike').checked = true;
            document.getElementById('filter-bicycle').checked = true;
            document.getElementById('min-price').value = 0;
            document.getElementById('max-price').value = 10;
            loadVehiclesOnMap();
            loadCarList();
        }

        function initUserMenu() {
            const userInfo = JSON.parse(localStorage.getItem("userInfo"));
            const menuElement = document.getElementById("userMenu");
            if (!userInfo) return;

            menuElement.innerHTML = "";
            if (userInfo.role === "user") {
                menuElement.innerHTML = `
                    <li><a class="dropdown-item" href="/personalInfo.html">ä¸ªäººä¿¡æ¯</a></li>
                    <li><a class="dropdown-item" href="/rent.html">è½¦è¾†å‘å¸ƒ</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="#" id="logoutBtn">é€€å‡ºç™»å½•</a></li>
                `;
            } else if (userInfo.role === "admin") {
                menuElement.innerHTML = `
                    <li><a class="dropdown-item" href="/personalInfo.html">ä¸ªäººä¿¡æ¯</a></li>
                    <li><a class="dropdown-item" href="/admin.html">ç®¡ç†å‘˜åå°</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="#" id="logoutBtn">é€€å‡ºç™»å½•</a></li>
                `;
            }

            document.getElementById("logoutBtn")?.addEventListener("click", () => {
                if (confirm("ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ")) {
                    localStorage.removeItem("token");
                    localStorage.removeItem("userInfo");
                    window.location.href = "/login.html";
                }
            });
        }

        function initRentMap() {
            if (typeof AMap === 'undefined') {
                setTimeout(initRentMap, 500);
                return;
            }
            map = new AMap.Map("rentMap", {
                zoom: 16,
                center: [112.58451, 37.79676],
                resizeEnable: true
            });

            loadVehiclesOnMap();
        }

        function loadVehiclesOnMap(vehiclesToShow = null) {
            if (!map) return;
            map.clearMap();
            markers = [];

            const vehicles = vehiclesToShow || allVehicles;
            vehicles.forEach(v => {
                const lnglat = v.lng && v.lat ? [parseFloat(v.lng), parseFloat(v.lat)] : [
                    112.58451 + (Math.random() - 0.5) * 0.01,
                    37.79676 + (Math.random() - 0.5) * 0.01
                ];

                const marker = new AMap.Marker({
                    position: lnglat,
                    title: v.location_desc,
                    icon: 'https://a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-default.png',
                    label: { content: `Â¥${v.price_per_hour}`, direction: 'top' }
                });

                marker.on('click', () => {
                    new AMap.InfoWindow({
                        content: `
                            <div style="padding:10px;">
                                <h4>${v.type === 'ebike' ? 'ç”µåŠ¨è½¦' : 'è‡ªè¡Œè½¦'}</h4>
                                <p><strong>ä½ç½®ï¼š</strong>${v.location_desc}</p>
                                <p><strong>ä»·æ ¼ï¼š</strong>Â¥${v.price_per_hour}/å°æ—¶</p>
                                <p><strong>è½¦ä¸»ï¼š</strong>${v.owner_name}</p>
                                <button class="btn btn-sm btn-primary w-100 rent-btn" 
                                        data-id="${v.vehicle_id}" 
                                        data-type="${v.type === 'ebike' ? 'ç”µåŠ¨è½¦' : 'è‡ªè¡Œè½¦'}" 
                                        data-location="${v.location_desc}" 
                                        data-price="${v.price_per_hour}" 
                                        data-owner="${v.owner_name}">
                                    ç«‹å³ç§Ÿç”¨
                                </button>
                            </div>
                        `,
                        offset: new AMap.Pixel(0, -30)
                    }).open(map, lnglat);
                });

                marker.setMap(map);
                markers.push(marker);
            });
        }

        function loadCarList(vehiclesToShow = null) {
            const vehicles = vehiclesToShow || allVehicles;
            const listContainer = document.getElementById("carListContainer");
            listContainer.innerHTML = "";

            if (vehicles.length === 0) {
                listContainer.innerHTML = '<p class="text-center text-muted">æš‚æ— ç¬¦åˆæ¡ä»¶çš„è½¦è¾†</p>';
                return;
            }

            vehicles.forEach(v => {
                const carCard = document.createElement("div");
                carCard.className = "car-card";
                carCard.innerHTML = `
                    <img src="https://cdn-icons-png.flaticon.com/512/2926/2926655.png" class="car-img" alt="${v.type === 'ebike' ? 'ç”µåŠ¨è½¦' : 'è‡ªè¡Œè½¦'}">
                    <div class="car-info">
                        <span class="car-type">${v.type === 'ebike' ? 'ç”µåŠ¨è½¦' : 'è‡ªè¡Œè½¦'}</span>
                        <p class="car-price">${v.price_per_hour}å…ƒ/å°æ—¶ Â· ${v.location_desc}</p>
                        <p class="car-owner">è½¦ä¸»ï¼š${v.owner_name}</p>
                    </div>
                    <button class="btn btn-primary rent-btn" 
                            data-id="${v.vehicle_id}" 
                            data-type="${v.type === 'ebike' ? 'ç”µåŠ¨è½¦' : 'è‡ªè¡Œè½¦'}" 
                            data-location="${v.location_desc}" 
                            data-price="${v.price_per_hour}" 
                            data-owner="${v.owner_name}">
                        ç§Ÿè½¦
                    </button>
                `;
                listContainer.appendChild(carCard);
            });
        }

        function bindModeSwitch() {
            const mapModeBtn = document.getElementById("mapModeBtn");
            const listModeBtn = document.getElementById("listModeBtn");
            const rentMap = document.getElementById("rentMap");
            const carList = document.getElementById("carListContainer");

            mapModeBtn.addEventListener("click", () => {
                mapModeBtn.classList.add("active");
                listModeBtn.classList.remove("active");
                rentMap.style.display = "block";
                carList.style.display = "none";
                if (map) {
                    setTimeout(() => map.getSize(), 100);
                }
            });

            listModeBtn.addEventListener("click", () => {
                listModeBtn.classList.add("active");
                mapModeBtn.classList.remove("active");
                rentMap.style.display = "none";
                carList.style.display = "block";
            });
        }

        function bindRentEvents() {
            const rentModal = new bootstrap.Modal(document.getElementById("rentModal"));
            const rentHoursInput = document.getElementById("rentHours");
            const calcPrice = document.getElementById("calcPrice");
            const calcHours = document.getElementById("calcHours");
            const calcTotal = document.getElementById("calcTotal");
            const submitRentBtn = document.getElementById("submitRentBtn");

            document.addEventListener("click", (e) => {
                if (e.target.classList.contains("rent-btn")) {
                    const carId = e.target.dataset.id;
                    const carType = e.target.dataset.type;
                    const carLocation = e.target.dataset.location;
                    const carPrice = e.target.dataset.price;
                    const carOwner = e.target.dataset.owner;

                    document.getElementById("rentCarId").value = carId;
                    document.getElementById("modalCarType").textContent = carType;
                    document.getElementById("modalCarLocation").textContent = carLocation;
                    document.getElementById("modalCarPrice").textContent = carPrice;
                    document.getElementById("modalCarOwner").textContent = carOwner;
                    calcPrice.textContent = carPrice;
                    calcHours.textContent = rentHoursInput.value;
                    calcTotal.textContent = (carPrice * rentHoursInput.value).toFixed(1);

                    rentModal.show();
                }
            });

            rentHoursInput.addEventListener("input", () => {
                const hours = rentHoursInput.value;
                const price = calcPrice.textContent;
                calcHours.textContent = hours;
                calcTotal.textContent = (price * hours).toFixed(1);
            });

            submitRentBtn.addEventListener("click", async () => {
                const carId = document.getElementById("rentCarId").value;
                const hours = rentHoursInput.value;
                const totalFee = calcTotal.textContent;
                const carType = document.getElementById("modalCarType").textContent;
                const carLocation = document.getElementById("modalCarLocation").textContent;
                const user_id = localStorage.getItem('user_id');

                if (!user_id) {
                    alert('è¯·å…ˆç™»å½•');
                    window.location.href = '/login.html';
                    return;
                }

                if (!hours || hours <= 0) {
                    alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ç§Ÿç”¨æ—¶é•¿');
                    return;
                }

                // ç¦ç”¨æŒ‰é’®é˜²æ­¢é‡å¤æäº¤
                submitRentBtn.disabled = true;
                submitRentBtn.textContent = 'æäº¤ä¸­...';

                try {
                    const res = await fetch('/api/orders', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': 'Bearer ' + user_id
                        },
                        body: JSON.stringify({
                            vehicle_id: carId,
                            hours: parseInt(hours)
                        })
                    });
                    const result = await res.json();

                    if (res.ok) {
                        // éšè—ç§Ÿè½¦Modal
                        rentModal.hide();
                        
                        // å¡«å……è®¢å•æˆåŠŸModalçš„æ•°æ®
                        document.getElementById('successOrderId').textContent = result.order_id || '-';
                        document.getElementById('successCarType').textContent = carType;
                        document.getElementById('successLocation').textContent = carLocation;
                        document.getElementById('successHours').textContent = hours;
                        document.getElementById('successFee').textContent = totalFee;
                        
                        // æ˜¾ç¤ºè½¦ä¸»ä¿¡æ¯ï¼ˆåŠ å¯†æ˜¾ç¤ºï¼‰
                        if (result.owner_info) {
                            const ownerName = result.owner_info.name;
                            const ownerPhone = result.owner_info.phone;
                            
                            // å§“ååŠ å¯†ï¼šåªæ˜¾ç¤ºå§“
                            const encryptedName = ownerName.charAt(0) + '*'.repeat(ownerName.length - 1);
                            document.getElementById('successOwnerName').textContent = encryptedName;
                            
                            // æ‰‹æœºå·åŠ å¯†ï¼šæ˜¾ç¤ºå‰3ä½å’Œå4ä½
                            const encryptedPhone = ownerPhone.substring(0, 3) + '****' + ownerPhone.substring(7);
                            document.getElementById('successOwnerPhone').textContent = encryptedPhone;
                        }
                        
                        // æ˜¾ç¤ºè®¢å•æˆåŠŸModal
                        const successModal = new bootstrap.Modal(document.getElementById('orderSuccessModal'));
                        successModal.show();
                    } else {
                        alert(result.msg || 'è®¢å•åˆ›å»ºå¤±è´¥');
                    }
                } catch (error) {
                    console.error('è®¢å•åˆ›å»ºå¤±è´¥', error);
                    alert('è®¢å•åˆ›å»ºå¤±è´¥ï¼š' + error.message);
                } finally {
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    submitRentBtn.disabled = false;
                    submitRentBtn.textContent = 'æäº¤è®¢å•';
                }
            });
        }
    </script>
</body>
</html>

